(this["webpackJsonpcado-web-client"]=this["webpackJsonpcado-web-client"]||[]).push([[0],{118:function(e,n,t){},119:function(e,n,t){},152:function(e,n,t){"use strict";t.r(n);var c=t(0),a=t.n(c),i=t(12),l=t.n(i),r=(t(118),t(13)),o=(t(119),t(193)),s=t(207),u=t(194),d=t(188),j=t(189),b=t(154),O=t(213),h=t(202),f=t(205),g=t(192),m=t(101),p=t(4),x=function(e){var n=e.onFileUpload;return Object(p.jsx)(m.a,{maxFileSize:1e9,onChange:function(e){null===n||void 0===n||n.apply(null,[e])}})},v=t(208),S=t(209),C=t(210),E=t(195),F=t(204),I=t(99),w={API_BASE_URL:"https://magman.synology.me:4430/api",GENERIC_USER_KEY:1006},y=t.n(I).a.create({baseURL:w.API_BASE_URL,headers:{"Content-Type":"application/json"}}),U=Object(o.a)((function(e){return Object(s.a)({root:{margin:e.spacing(1)}})})),k=function(e){var n,t=e.onSelectedScenarioChange,a=U(),i=Object(c.useState)(null),l=Object(r.a)(i,2),o=l[0],s=l[1],j=Object(c.useState)(null),O=Object(r.a)(j,2),h=O[0],f=O[1],g=Object(c.useCallback)((function(e){f(e),null!==e&&t(e)}),[]);Object(c.useEffect)((function(){y.get("/scenarios").then((function(e){if(200===e.status){var n=e.data;s(n),n.length>0&&g(n[0])}else s(null)}))}),[g]);return Object(p.jsx)("div",{className:a.root,children:Object(p.jsx)(d.a,{container:!0,direction:"column",justifyContent:"center",alignItems:"center",children:null===o?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(u.a,{}),Object(p.jsx)(b.a,{children:"Loading scenarios..."})]}):Object(p.jsxs)(v.a,{component:"fieldset",children:[Object(p.jsx)(S.a,{component:"legend",children:"Scenarios"}),Object(p.jsx)(C.a,{name:"scenario",value:null!==(n=null===h||void 0===h?void 0:h.id)&&void 0!==n?n:-1,onChange:function(e){var n,t=Number.parseInt(e.target.value);g(null!==(n=null===o||void 0===o?void 0:o.find((function(e){return e.id===t})))&&void 0!==n?n:null)},children:null!==o&&o.map((function(e){return Object(p.jsx)(E.a,{value:e.id,control:Object(p.jsx)(F.a,{color:"primary"}),label:e.name},e.id)}))})]})})})},N=t(211),A=t(212),R=t(203),_=t(198),B=t(67),L=t(66),P=t(196),K=t(197),D=Object(o.a)((function(e){return Object(s.a)({doneAvatar:{backgroundColor:B.a[500],width:e.spacing(3),height:e.spacing(3)},errorAvatar:{backgroundColor:L.a[500],width:e.spacing(3),height:e.spacing(3)}})})),T=function(e){var n=e.file,t=e.onEnd,a=e.onValidUpload,i=D(),l=Object(c.useState)(0),o=Object(r.a)(l,2),s=o[0],u=o[1],j=Object(c.useState)(!1),O=Object(r.a)(j,2),h=O[0],f=O[1],g=Object(c.useState)(null),m=Object(r.a)(g,2),x=m[0],v=m[1],S=function(e){e.stopPropagation(),u(Math.round(100*e.loaded/e.total)),e.loaded===e.total&&(f(!0),null===t||void 0===t||t.call(null))};return Object(c.useEffect)((function(){var e=new FormData;e.append("UserFK",w.GENERIC_USER_KEY.toString()),e.append("CadModelFile",n),y.post("/models",e,{onUploadProgress:S}).then((function(e){if(201!==e.status)v("".concat(e.status," ").concat(e.statusText));else{var n=e.data;null===a||void 0===a||a.call(null,n.id)}})).catch((function(e){v(e.message)}))}),[]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(d.a,{container:!0,justifyContent:"center",direction:"row",alignItems:"center",children:Object(p.jsx)(b.a,{children:n.name})}),Object(p.jsxs)(R.a,{display:"flex",alignItems:"center",children:[Object(p.jsx)(R.a,{width:"90%",mr:1,children:Object(p.jsx)(_.a,{variant:"determinate",value:s})}),Object(p.jsx)(R.a,{minWidth:35,children:null!==x?Object(p.jsx)(N.a,{title:x,children:Object(p.jsx)(A.a,{className:i.errorAvatar,children:Object(p.jsx)(P.a,{})})}):h?Object(p.jsx)(A.a,{className:i.doneAvatar,children:Object(p.jsx)(K.a,{})}):Object(p.jsxs)(b.a,{children:[s," %"]})})]})]})},z=function(e){var n=e.files,t=e.onFileUploadEnd,a=Object(c.useState)(0),i=Object(r.a)(a,2),l=i[0],o=i[1],s=Object(c.useState)([]),u=Object(r.a)(s,2),d=u[0],j=u[1],O=Object(c.useCallback)((function(){o((function(e){return e+1}))}),[]),h=function(e){j((function(n){var t=n.slice();return t.push(e),t}))};return Object(c.useEffect)((function(){d.length>=n.length&&(null===t||void 0===t||t.call(null,d))}),[l,d]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(b.a,{children:l===n.length?"Upload done !":"Uploading files... (".concat(l,"/").concat(n.length,")")}),n.map((function(e,n){return Object(p.jsx)(T,{file:e,onEnd:O,onValidUpload:h},n)}))]})},G=t(206),J=t(199),M=t(201),W=t(200);var Y=function(e,n){var t=Object(c.useRef)(e);Object(c.useEffect)((function(){t.current=e}),[e]),Object(c.useEffect)((function(){if(null!==n){var e=setInterval((function(){return t.current()}),n);return function(){return clearInterval(e)}}}),[n])},H=Object(o.a)((function(e){return Object(s.a)({downloadButton:{margin:e.spacing(1)}})})),V=function(e){var n,t=e.modelId,a=e.scenario,i=H(),l=Object(c.useState)(null),o=Object(r.a)(l,2),s=o[0],u=o[1],d=Object(c.useState)(null),j=Object(r.a)(d,2),O=(j[0],j[1]),h=Object(c.useState)(null),f=Object(r.a)(h,2),m=f[0],x=f[1],v=Object(c.useState)(!1),S=Object(r.a)(v,2),C=S[0],E=S[1];return Y((function(){var e;y.get("/processes/".concat(null!==(e=null===s||void 0===s?void 0:s.id)&&void 0!==e?e:0)).then((function(e){x(e.data),2==(null===m||void 0===m?void 0:m.status)&&E(!0)}))}),null===s||C?null:1e3),Object(c.useEffect)((function(){var e=new FormData;e.append("modelInFK",t.toString()),e.append("scenarioFK",a.id.toString()),e.append("userFK",w.GENERIC_USER_KEY.toString()),y.post("/processes",JSON.stringify(Object.fromEntries(e))).then((function(e){201!==e.status?O("".concat(e.status," ").concat(e.statusText)):u(e.data)})).catch((function(e){O(e.message)}))}),[]),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(b.a,{children:["Processing model #",t," with scenario ",a.name]}),C?Object(p.jsx)(g.a,{className:i.downloadButton,onClick:function(){if(null!==m){var e="".concat(w.API_BASE_URL,"/models/download/").concat(m.modelOutFK),n=document.createElement("a");n.href=e,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)}},variant:"contained",color:"primary",size:"large",children:"Download"}):null,Object(p.jsxs)(G.a,{children:[Object(p.jsx)(J.a,{expandIcon:Object(p.jsx)(W.a,{}),id:t.toString(),children:"See Log"}),Object(p.jsx)(M.a,{children:Object(p.jsx)("pre",{children:Object(p.jsx)("code",{children:null!==(n=null===m||void 0===m?void 0:m.log.replace(/\r/g,"\n"))&&void 0!==n?n:"..."})})})]})]})},q=function(e){var n=e.scenario,t=e.modelIds;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(b.a,{children:"Processes :"}),t.map((function(e,t){return Object(p.jsx)(V,{modelId:e,scenario:n},t)}))]})},Q=function(e){var n=e.files,t=e.scenario,a=Object(c.useState)(null),i=Object(r.a)(a,2),l=i[0],o=i[1];return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(z,{files:n,onFileUploadEnd:function(e){o(e)}}),null!==l&&l.length===n.length?Object(p.jsx)(q,{scenario:t,modelIds:l}):null]})},X=Object(o.a)((function(e){return Object(s.a)({paper:{width:"50%",minWidth:"50rem",padding:e.spacing(2)},steps:{width:"90%"},contentContainer:{minHeight:"20rem",minWidth:"50rem"},backButton:{marginRight:e.spacing(1)},instructions:{marginTop:e.spacing(1),marginBottom:e.spacing(1)}})}));var Z=function(){var e=X(),n=Object(c.useState)(0),t=Object(r.a)(n,2),a=t[0],i=t[1],l=Object(c.useState)(null),o=Object(r.a)(l,2),s=o[0],m=o[1],v=Object(c.useState)(null),S=Object(r.a)(v,2),C=S[0],E=S[1],F=["Select CAD file(s)","Choose scenario","Get your files"],I=function(e){m(e)},w=function(e){E(e)};return Object(p.jsx)(d.a,{container:!0,spacing:0,direction:"column",alignItems:"center",justifyContent:"center",style:{minHeight:"100vh"},children:Object(p.jsxs)(j.a,{className:e.paper,children:[Object(p.jsxs)(d.a,{container:!0,direction:"column",alignItems:"center",justifyContent:"center",children:[Object(p.jsx)(b.a,{variant:"h4",children:"ASCAD"}),Object(p.jsx)(b.a,{variant:"h6",children:"Simplify and Convert"}),Object(p.jsx)(O.a,{className:e.steps,activeStep:a,alternativeLabel:!0,children:F.map((function(e){return Object(p.jsx)(h.a,{children:Object(p.jsx)(f.a,{children:e})},e)}))}),Object(p.jsx)("div",{className:e.contentContainer,children:function(e){switch(e){case 0:return Object(p.jsxs)("div",{children:[Object(p.jsx)(x,{onFileUpload:I}),Object(p.jsx)("ul",{children:null!==s&&s.map((function(e,n){return Object(p.jsx)("li",{children:e.name},n)}))})]});case 1:return Object(p.jsx)(k,{onSelectedScenarioChange:w});case 2:return null!==s&&null!==C?Object(p.jsx)(Q,{files:s,scenario:C}):Object(p.jsx)(u.a,{});default:return Object(p.jsx)("div",{children:"Unknown stepIndex"})}}(a)})]}),Object(p.jsx)(d.a,{container:!0,direction:"row",justifyContent:"flex-end",alignItems:"center",children:a===F.length?Object(p.jsx)(g.a,{onClick:function(){i(0)},size:"large",children:"Restart"}):Object(p.jsxs)("div",{children:[Object(p.jsx)(g.a,{disabled:0===a,size:"large",onClick:function(){i((function(e){return e-1}))},className:e.backButton,children:"Back"}),Object(p.jsx)(g.a,{variant:"contained",color:"primary",size:"large",onClick:function(){i((function(e){return e+1}))},disabled:!function(){switch(a){case 0:return null!==s&&s.length>0;case 1:return null!==C;default:return!0}}(),children:a===F.length-1?"Finish":"Next"})]})})]})})},$=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,215)).then((function(n){var t=n.getCLS,c=n.getFID,a=n.getFCP,i=n.getLCP,l=n.getTTFB;t(e),c(e),a(e),i(e),l(e)}))};l.a.render(Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(Z,{})}),document.getElementById("root")),$()}},[[152,1,2]]]);
//# sourceMappingURL=main.c7b36e31.chunk.js.map